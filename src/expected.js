const _         = require("lodash");
const boards    = require("./maps/out/map.json");

console.time("expected");      //-- start the timer

let all_roles   = [];
let unsolvable  = 0;

let indexes = [2,15,20,28,33,39,42,44,45,49,51,54,57,81,87,89,93,99,108,110,112,113,122,128,137,141,142,145,147,151,157,159,160,165,178,188,190,192,202,214,217,224,230,231,241,257,258,261,263,270,271,276,280,281,294,297,310,315,326,342,343,347,353,354,357,360,374,375,384,386,388,405,406,410,429,434,437,448,449,452,455,457,458,478,480,484,485,499,501,506,509,512,513,514,522,524,530,534,539,545,554,558,568,569,571,574,585,591,600,608,609,613,614,624,626,641,643,645,655,662,663,677,687,689,692,694,700,702,707,708,712,726,731,734,735,737,748,749,750,756,758,769,770,773,787,788,792,804,805,834,839,849,850,852,857,858,864,866,877,878,885,888,898,900,902,903,905,909,923,927,931,935,947,954,956,957,960,965,968,973,989,995,996,997,1000,1002,1016,1018,1024,1032,1036,1037,1040,1044,1046,1057,1061,1062,1064,1073,1074,1080,1083,1087,1093,1097,1100,1107,1113,1115,1116,1119,1135,1139,1144,1148,1168,1170,1173,1189,1192,1198,1203,1206,1209,1214,1216,1227,1230,1241,1248,1260,1263,1264,1266,1272,1284,1286,1298,1299,1300,1315,1319,1320,1321,1322,1325,1336,1356,1365,1368,1372,1382,1393,1406,1409,1415,1419,1424,1428,1429,1431,1434,1435,1445,1453,1459,1460,1467,1474,1476,1481,1482,1485,1492,1493,1495,1499,1504,1509,1520,1521,1530,1533,1544,1577,1581,1600,1619,1631,1633,1636,1639,1647,1653,1661,1665,1667,1672,1673,1682,1684,1691,1704,1708,1721,1730,1737,1745,1761,1765,1767,1768,1775,1780,1781,1786,1792,1798,1799,1812,1814,1821,1827,1832,1834,1835,1842,1850,1852,1856,1857,1859,1865,1867,1871,1873,1875,1877,1880,1882,1886,1891,1894,1906,1910,1913,1915,1917,1918,1921,1928,1933,1939,1942,1943,1957,1959,1961,1967,1973,1976,1981,1982,1983,1991,1996,2009,2015,2017,2020,2023,2035,2042,2045,2050,2051,2056,2062,2067,2069,2076,2084,2099,2100,2102,2111,2116,2117,2126,2127,2129,2130,2132,2144,2146,2147,2149,2163,2168,2170,2171,2183,2184,2187,2188,2195,2199,2201,2207,2208,2222,2223,2227,2228,2234,2244,2247,2248,2254,2258,2259,2264,2269,2275,2277,2293,2295,2299,2304,2308,2317,2318,2322,2330,2336,2339,2341,2347,2363,2375,2376,2380,2381,2384,2389,2401,2407,2410,2420,2421,2442,2444,2454,2462,2463,2468,2470,2472,2488,2490,2492,2493,2504,2506,2510,2516,2524,2530,2537,2541,2542,2543,2551,2557,2571,2577,2580,2587,2589,2593,2596,2605,2607,2608,2610,2612,2623,2630,2639,2641,2648,2655,2669,2670,2671,2677,2680,2683,2688,2690,2695,2699,2711,2719,2721,2729,2735,2741,2750,2753,2756,2758,2773,2775,2776,2785,2790,2792,2793,2800,2805,2806,2817,2819,2826,2829,2830,2837,2855,2857,2859,2865,2876,2878,2887,2892,2907,2910,2911,2915,2918,2921,2924,2925,2931,2933,2934,2941,2949,2959,2962,2969,2970,2992,2994,2997,2998,2999,3002,3007,3020,3021,3027,3031,3038,3045,3050,3058,3060,3061,3064,3070,3071,3073,3074,3077,3082,3083,3088,3106,3108,3122,3126,3127,3128,3129,3138,3140,3141,3145,3155,3159,3161,3165,3166,3170,3173,3179,3184,3185,3193,3200,3202,3203,3204,3215,3220,3222,3225,3232,3243,3254,3257,3258,3260,3261,3263,3266,3271,3273,3277,3278,3279,3284,3286,3287,3295,3299,3303,3308,3314,3319,3320,3328,3334,3339,3343,3344,3347,3352,3356,3359,3368,3369,3376,3399,3409,3412,3427,3433,3443,3444,3449,3450,3453,3468,3474,3484,3493,3504,3519,3522,3525,3531,3535,3539,3541,3542,3546,3556,3559,3560,3562,3579,3580,3583,3584,3585,3590,3595,3603,3606,3610,3617,3623,3624,3632,3634,3636,3639,3646,3648,3650,3655,3665,3667,3672,3675,3686,3687,3712,3715,3722,3724,3728,3729,3733,3734,3737,3742,3757,3765,3779,3800,3803,3809,3813,3821,3828,3829,3837,3841,3844,3848,3849,3861,3862,3868,3872,3875,3878,3881,3886,3891,3896,3900,3904,3908,3909,3911,3919,3920,3924,3933,3939,3942,3944,3957,3958,3960,3964,3969,3971,3976,3977,3979,3990,3997,3998,4000,4001,4007,4008,4019,4031,4036,4037,4045,4047,4051,4059,4061,4067,4080,4084,4090,4098,4103,4105,4108,4109,4119,4125,4139,4147,4148,4162,4167,4169,4171,4180,4182,4193,4198,4202,4205,4216,4234,4235,4243,4251,4255,4266,4267,4279,4284,4289,4294,4301,4315,4326,4331,4336,4338,4341,4347,4350,4360,4362,4365,4366,4378,4380,4381,4382,4389,4401,4404,4406,4412,4418,4430,4437,4439,4441,4448,4449,4461,4470,4472,4476,4483,4489,4491,4494,4497,4506,4509,4510,4512,4516,4520,4521,4525,4527,4535,4546,4557,4558,4559,4565,4568,4573,4575,4576,4585,4591,4592,4601,4608,4611,4622,4623,4624,4625,4630,4637,4642,4646,4649,4651,4654,4661,4673,4675,4677,4679,4686,4695,4698,4719,4748,4751,4765,4766,4773,4777,4779,4784,4785,4790,4793,4795,4800,4809,4814,4815,4816,4822,4834,4848,4850,4854,4856,4862,4875,4880,4882,4886,4887,4893,4900,4907,4919,4925,4931,4936,4941,4953,4962,4964,4976,4979,4980,4983,4985,4990,4995,4998,5000,5004,5007,5021,5023,5039,5053,5056,5064,5065,5067,5069,5073,5078,5087,5089,5094,5100,5105,5111,5117,5120,5123,5129,5133,5136,5137,5156,5168,5171,5175,5188,5211,5214,5218,5219,5222,5224,5240,5242,5246,5248,5258,5261,5262,5263,5279,5283,5288,5294,5318,5319,5327,5340,5347,5357,5360,5372,5375,5377,5382,5385,5387,5391,5395,5400,5402,5405,5409,5413,5420,5425,5430,5432,5433,5444,5445,5446,5447,5451,5452,5453,5454,5455,5457,5461,5463,5477,5482,5485,5486,5491,5498,5504,5507,5510,5516,5523,5526,5532,5533,5535,5536,5539,5543,5547,5551,5552,5557,5562,5563,5565,5570,5574,5585,5586,5587,5595,5597,5598,5601,5604,5606,5613,5619,5628,5635,5639,5640,5644,5647,5648,5650,5655,5663,5665,5666,5668,5672,5673,5674,5677,5687,5689,5696,5697,5701,5702,5707,5708,5710,5718,5719,5723,5727,5731,5735,5736,5737,5748,5750,5754,5760,5777,5778,5781,5783,5785,5791,5793,5797,5800,5808,5811,5821,5832,5833,5839,5841,5855,5859,5860,5862,5863,5864,5883,5895,5898,5913,5921,5923,5929,5941,5942,5943,5944,5947,5950,5963,5964,5966,5973,5974,5979,5981,5982,5983,5990,5991,5998,5999,6001,6004,6027,6029,6033,6036,6037,6043,6045,6050,6051,6058,6059,6066,6067,6071,6072,6076,6081,6086,6098,6100,6103,6105,6106,6107,6109,6118,6124,6127,6132,6141,6143,6162,6170,6172,6176,6193,6194,6201,6203,6205,6211,6214,6227,6233,6238,6241,6244,6246,6253,6263,6264,6266,6275,6277,6286,6292,6305,6306,6313,6319,6326,6345,6349,6351,6353,6359,6362,6363,6369,6374,6382,6391,6392,6401,6404,6414,6415,6417,6422,6428,6431,6432,6437,6438,6439,6449,6451,6453,6456,6457,6463,6465,6470,6472,6476,6480,6485,6488,6490,6494,6495,6496,6497,6498,6503,6504,6507,6527,6529,6533,6534,6538,6540,6547,6548,6554,6555,6558,6561,6562,6569,6571,6574,6585,6600,6602,6604,6607,6623,6626,6629,6636,6643,6648,6660,6667,6669,6679,6690,6694,6707,6723,6724,6725,6729,6730,6745,6749,6752,6757,6766,6767,6770,6780,6804,6808,6811,6816,6830,6831,6832,6834,6841,6852,6857,6862,6873,6875,6876,6884,6885,6896,6900,6901,6912,6915,6921,6929,6955,6959,6960,6961,6964,6970,6972,6990,7003,7005,7006,7008,7011,7013,7015,7019,7023,7024,7025,7026,7028,7030,7033,7034,7038,7045,7054,7056,7066,7078,7082,7085,7092,7102,7106,7108,7110,7111,7116,7120,7123,7128,7132,7138,7145,7149,7152,7160,7163,7168,7173,7174,7177,7180,7183,7192,7194,7195,7201,7203,7205,7246,7249,7252,7262,7265,7268,7269,7271,7272,7277,7281,7283,7284,7286,7296,7300,7306,7330,7332,7334,7337,7338,7341,7347,7353,7358,7359,7362,7365,7370,7375,7387,7399,7402,7405,7415,7417,7418,7440,7446,7449,7456,7462,7467,7475,7477,7479,7481,7497,7514,7515,7516,7517,7525,7532,7536,7537,7538,7549,7550,7552,7558,7568,7570,7573,7581,7584,7593,7623,7625,7630,7655,7659,7660,7667,7670,7673,7674,7676,7677,7684,7698,7702,7704,7705,7710,7712,7719,7722,7733,7750,7754,7757,7758,7760,7762,7764,7770,7771,7777,7779,7790,7805,7807,7816,7822,7826,7833,7834,7837,7842,7846,7848,7851,7852,7875,7876,7878,7890,7891,7906,7915,7920,7937,7942,7943,7945,7949,7956,7969,7976,7978,7981,7996,7998,7999,8001,8007,8009,8012,8017,8021,8025,8028,8033,8037,8060,8063,8072,8074,8076,8078,8084,8093,8099,8104,8106,8116,8117,8118,8121,8124,8128,8129,8130,8131,8133,8137,8146,8151,8152,8164,8165,8167,8171,8176,8184,8186,8189,8207,8218,8232,8241,8245,8259,8260,8262,8274,8284,8291,8295,8306,8312,8316,8317,8324,8327,8335,8336,8346,8356,8361,8362,8367,8368,8370,8371,8379,8381,8387,8388,8391,8395,8397,8400,8404,8433,8434,8447,8456,8460,8463,8466,8467,8468,8476,8477,8481,8485,8495,8498,8500,8502,8509,8510,8512,8516,8520,8528,8540,8547,8548,8551,8554,8563,8569,8571,8573,8574,8588,8597,8609,8612,8613,8614,8617,8619,8621,8628,8631,8634,8637,8638,8654,8659,8663,8666,8673,8677,8687,8689,8692,8696,8698,8699,8702,8707,8711,8718,8723,8724,8730,8750,8754,8773,8776,8787,8793,8798,8806,8807,8810,8813,8817,8820,8826,8833,8844,8845,8851,8859,8866,8872,8874,8875,8887,8894,8897,8902,8903,8906,8919,8922,8929,8934,8940,8948,8952,8953,8957,8958,8961,8968,8970,8971,8974,8986,8994,8995,8997,8999,9007,9010,9017,9022,9025,9027,9028,9036,9045,9047,9052,9067,9068,9069,9072,9080,9081,9086,9087,9105,9106,9121,9131,9135,9136,9138,9145,9150,9151,9159,9176,9179,9180,9194,9203,9205,9209,9210,9217,9219,9224,9227,9230,9241,9246,9247,9249,9254,9256,9261,9266,9274,9275,9278,9279,9289,9291,9297,9300,9313,9316,9330,9334,9336,9346,9358,9364,9366,9370,9374,9377,9379,9380,9398,9402,9410,9412,9420,9432,9444,9460,9461,9467,9469,9479,9481,9486,9491,9498,9520,9524,9526,9527,9534,9545,9562,9572,9576,9578,9588,9594,9599,9602,9605,9616,9624,9626,9644,9654,9655,9657,9658,9660,9662,9666,9671,9673,9676,9681,9695,9699,9702,9705,9713,9715,9719,9724,9736,9744,9745,9746,9753,9755,9756,9758,9760,9761,9767,9771,9773,9774,9780,9785,9786,9791,9792,9797,9808,9813,9816,9821,9835,9848,9854,9859,9863,9869,9877,9878,9880,9882,9890,9891,9896,9898,9902,9903,9908,9911,9913,9923,9924,9925,9926,9928,9931,9948,9960,9963,9965,9966,9968,9978,9979,9982,9985,9993,9997];

_.forEach(boards, (board, board_number) => {
    // if(board_number !== 0) return;
    let rolls = [];
    let position = 0;
    let finish = board.map[0] * board.map[1];

    let chutes = _
        .chain(board.extras)
        .filter(extra => extra.type === "C")
        .keyBy("end")
        .value();

    let ladders = _
        .chain(board.extras)
        .filter(extra => extra.type === "L")
        .keyBy("start")
        .value();

    if(chutes[finish] || _.includes(indexes, board_number)) {
        // console.log("unsolvable one");
        unsolvable++;
        return;
    }
    // console.log("\n\n chutes", chutes);
    // console.log("\n\n ladders", ladders);

    for (let i = 0; i < 100000; i++) {
        rolls[i] = 0;

        while (position < finish) {

            let new_position = position + _.random(1, 6);
            // console.log(`N ${rolls[i]} New position ${new_position}`);

            if (ladders[new_position]) {
                new_position = ladders[new_position].end;
                // console.log(`N ${rolls[i]} Ladder ${new_position}`);
            }

            if (chutes[new_position]) {
                new_position = chutes[new_position].start;
                // console.log(`N ${rolls[i]} Chute ${new_position}`);
            }

            if (new_position <= finish) {
                position = new_position;
            } else {
                // console.log("skip the step", position, new_position);
            }

            rolls[i]++;
        }
        position = 0;
    }

    console.log("Done", board_number, _.mean(rolls));

    all_roles.push(_.mean(rolls));
});

console.log("Success!!!", all_roles, _.mean(all_roles), unsolvable);
console.timeEnd("expected");